From 796664948ca33ce6353dc6494db3a71b25c51bb9 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=C3=8Dcaro=20Hoff?= <icarohoff@gmail.com>
Date: Sat, 8 Oct 2016 19:05:02 -0300
Subject: [PATCH 1/3] build: improve and make CAF's kernel task ccache more
 flexible
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- Enhance ccache logic to opt-out when USE_CCACHE="false".
- Improve build messages to consistency.
- Set ccache globally when available instead of per-make basis.
- Use host's ccache here as well if installed.
- Make the kernel task more informational.
- Verbose ccache state during task start up.

Change-Id: I1f657f1b871c20885a521482d2b80c9058197281
Signed-off-by: √çcaro Hoff <icarohoff@gmail.com>

Conflicts:
	core/tasks/kernel.mk

Signed-off-by: sub77 <sub77@ymail.com>
---
 core/tasks/kernel.mk | 15 +++++++++++++--
 1 file changed, 13 insertions(+), 2 deletions(-)

diff --git a/core/tasks/kernel.mk b/core/tasks/kernel.mk
index 7cb011a..ac6333f 100644
--- a/core/tasks/kernel.mk
+++ b/core/tasks/kernel.mk
@@ -230,15 +230,26 @@ KERNEL_TOOLCHAIN_PATH := $(KERNEL_TOOLCHAIN)/$(KERNEL_TOOLCHAIN_PREFIX)
 endif
 endif
 
-ifneq ($(USE_CCACHE),)
-    # Detect if the system already has ccache installed to use instead of the prebuilt
+# Initialize ccache  as an empty argument.
+ccache :=
+
+# Fill the ccache argument if USE_CCACHE is not set to false.
+ifneq ($(filter-out false,$(USE_CCACHE)),)
+    # Detect if the system already has ccache installed.
     ccache := $(shell which ccache)
 
+    # Use the prebuilt one if host doesn't have ccache installed.
     ifeq ($(ccache),)
         ccache := $(ANDROID_BUILD_TOP)/prebuilts/misc/$(HOST_PREBUILT_TAG)/ccache/ccache
         # Check that the executable is here.
         ccache := $(strip $(wildcard $(ccache)))
     endif
+
+    # Print which ccache is going to be used to build the Kernel.
+    $(info Using '$(ccache)' binary)
+else
+# Warn the developer if ccache is set to false.
+$(info The usage of ccache is set to '$(USE_CCACHE)')
 endif
 
 KERNEL_CROSS_COMPILE := CROSS_COMPILE="$(ccache) $(KERNEL_TOOLCHAIN_PATH)"
-- 
2.1.4

